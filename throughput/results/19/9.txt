BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%firebrick%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 264880337.320935
 ALGERIA                   |   1997 | 458431837.351771
 ALGERIA                   |   1996 | 462592061.722143
 ALGERIA                   |   1995 | 458319203.153799
 ALGERIA                   |   1994 |  460954742.54159
 ALGERIA                   |   1993 | 461554393.703676
 ALGERIA                   |   1992 | 465276355.011044
 ARGENTINA                 |   1998 | 274306070.815477
 ARGENTINA                 |   1997 | 474180747.698361
 ARGENTINA                 |   1996 | 461663705.121666
 ARGENTINA                 |   1995 | 471745838.282766
 ARGENTINA                 |   1994 | 470152579.693006
 ARGENTINA                 |   1993 | 464697122.000461
 ARGENTINA                 |   1992 | 467424278.410604
 BRAZIL                    |   1998 | 281228997.063798
 BRAZIL                    |   1997 | 477337874.160177
 BRAZIL                    |   1996 | 472343264.410716
 BRAZIL                    |   1995 | 470896931.040141
 BRAZIL                    |   1994 | 473165575.716783
 BRAZIL                    |   1993 | 469201830.474732
 BRAZIL                    |   1992 | 477100378.003275
 CANADA                    |   1998 | 277807191.360868
 CANADA                    |   1997 | 475390422.800477
 CANADA                    |   1996 | 474311123.429145
 CANADA                    |   1995 |  471733401.22607
 CANADA                    |   1994 | 470148414.583081
 CANADA                    |   1993 | 476740642.976855
 CANADA                    |   1992 | 471497318.456907
 CHINA                     |   1998 | 268437094.495855
 CHINA                     |   1997 | 459751516.400879
 CHINA                     |   1996 | 459855289.495838
 CHINA                     |   1995 | 455533247.309014
 CHINA                     |   1994 | 454588406.369928
 CHINA                     |   1993 | 456123213.062632
 CHINA                     |   1992 | 455422857.863587
 EGYPT                     |   1998 | 270025997.257285
 EGYPT                     |   1997 | 474348139.200197
 EGYPT                     |   1996 | 476108852.068746
 EGYPT                     |   1995 | 472408468.392905
 EGYPT                     |   1994 | 468853253.889266
 EGYPT                     |   1993 | 472414273.247407
 EGYPT                     |   1992 | 473564592.571212
 ETHIOPIA                  |   1998 | 268804011.032887
 ETHIOPIA                  |   1997 |  451483663.22283
 ETHIOPIA                  |   1996 | 460684475.127702
 ETHIOPIA                  |   1995 | 456656310.767296
 ETHIOPIA                  |   1994 | 460863085.624848
 ETHIOPIA                  |   1993 | 460444713.595481
 ETHIOPIA                  |   1992 | 458033165.870627
 FRANCE                    |   1998 | 270101196.270833
 FRANCE                    |   1997 | 458232685.220734
 FRANCE                    |   1996 | 463711492.684546
 FRANCE                    |   1995 | 453052381.178986
 FRANCE                    |   1994 | 462284363.351267
 FRANCE                    |   1993 | 451864036.650353
 FRANCE                    |   1992 | 459455652.843883
 GERMANY                   |   1998 | 280760606.422631
 GERMANY                   |   1997 | 480893520.996489
 GERMANY                   |   1996 | 475233980.162158
 GERMANY                   |   1995 | 482455703.158812
 GERMANY                   |   1994 | 480346611.693087
 GERMANY                   |   1993 | 479599326.507258
 GERMANY                   |   1992 | 481568332.542702
 INDIA                     |   1998 | 279263785.282865
 INDIA                     |   1997 | 470489395.254039
 INDIA                     |   1996 | 468330007.294277
 INDIA                     |   1995 | 477540292.267548
 INDIA                     |   1994 | 471305570.241463
 INDIA                     |   1993 | 470019941.949523
 INDIA                     |   1992 | 478611247.833776
 INDONESIA                 |   1998 | 267657665.154547
 INDONESIA                 |   1997 | 464746257.847805
 INDONESIA                 |   1996 | 464981745.243629
 INDONESIA                 |   1995 | 465753136.710402
 INDONESIA                 |   1994 | 467527048.793844
 INDONESIA                 |   1993 | 464907879.758224
 INDONESIA                 |   1992 | 467744127.867681
 IRAN                      |   1998 | 274292826.454491
 IRAN                      |   1997 |  475331441.60319
 IRAN                      |   1996 | 470263093.736192
 IRAN                      |   1995 | 464944544.904775
 IRAN                      |   1994 | 471075817.618125
 IRAN                      |   1993 | 470643155.474512
 IRAN                      |   1992 | 475130927.622439
 IRAQ                      |   1998 | 277486034.402545
 IRAQ                      |   1997 | 469496973.943816
 IRAQ                      |   1996 | 476136205.436096
 IRAQ                      |   1995 | 483103141.226934
 IRAQ                      |   1994 | 471981219.193686
 IRAQ                      |   1993 | 477019764.098489
 IRAQ                      |   1992 | 477268492.995956
 JAPAN                     |   1998 | 275863290.002362
 JAPAN                     |   1997 |  474005737.89986
 JAPAN                     |   1996 | 473706494.560942
 JAPAN                     |   1995 | 472296673.905519
 JAPAN                     |   1994 | 476979055.410848
 JAPAN                     |   1993 | 467482753.937856
 JAPAN                     |   1992 | 468929458.423616
 JORDAN                    |   1998 | 262079729.378177
 JORDAN                    |   1997 | 450373165.815586
 JORDAN                    |   1996 | 455189311.278528
 JORDAN                    |   1995 | 446166188.250044
 JORDAN                    |   1994 | 456079873.877439
 JORDAN                    |   1993 | 455175411.129594
 JORDAN                    |   1992 | 451429228.726416
 KENYA                     |   1998 | 275062198.261013
 KENYA                     |   1997 | 468799927.742247
 KENYA                     |   1996 | 477045069.004587
 KENYA                     |   1995 | 469012582.896036
 KENYA                     |   1994 | 475788695.237512
 KENYA                     |   1993 | 469028151.473232
 KENYA                     |   1992 |  484171453.90811
 MOROCCO                   |   1998 |  275100455.86661
 MOROCCO                   |   1997 | 468960731.846601
 MOROCCO                   |   1996 | 471327547.431438
 MOROCCO                   |   1995 | 464910984.573527
 MOROCCO                   |   1994 | 469478716.526706
 MOROCCO                   |   1993 | 468592404.837232
 MOROCCO                   |   1992 |  473793068.86181
 MOZAMBIQUE                |   1998 | 266582664.169579
 MOZAMBIQUE                |   1997 | 453603902.213846
 MOZAMBIQUE                |   1996 | 468936187.589052
 MOZAMBIQUE                |   1995 | 457311507.570737
 MOZAMBIQUE                |   1994 | 452263940.465136
 MOZAMBIQUE                |   1993 | 462022314.638579
 MOZAMBIQUE                |   1992 | 461837769.387358
 PERU                      |   1998 | 275430530.721328
 PERU                      |   1997 |  468587114.37277
 PERU                      |   1996 | 469911104.588013
 PERU                      |   1995 | 465833666.251529
 PERU                      |   1994 | 460214074.192418
 PERU                      |   1993 | 470780969.967538
 PERU                      |   1992 | 467927098.297633
 ROMANIA                   |   1998 | 274126943.389193
 ROMANIA                   |   1997 |  461790597.98871
 ROMANIA                   |   1996 | 468217135.697514
 ROMANIA                   |   1995 |  464058848.96771
 ROMANIA                   |   1994 | 463977363.475147
 ROMANIA                   |   1993 | 468862502.911412
 ROMANIA                   |   1992 | 469545102.361618
 RUSSIA                    |   1998 | 278346350.164063
 RUSSIA                    |   1997 | 468990039.328765
 RUSSIA                    |   1996 | 475187372.709127
 RUSSIA                    |   1995 | 472090846.473835
 RUSSIA                    |   1994 | 468188449.495527
 RUSSIA                    |   1993 | 470567797.042001
 RUSSIA                    |   1992 | 462432604.886166
 SAUDI ARABIA              |   1998 | 284476619.917087
 SAUDI ARABIA              |   1997 | 472422364.143729
 SAUDI ARABIA              |   1996 | 477174507.461786
 SAUDI ARABIA              |   1995 | 476861384.182567
 SAUDI ARABIA              |   1994 | 470087314.606433
 SAUDI ARABIA              |   1993 | 474216162.319772
 SAUDI ARABIA              |   1992 | 472748650.932242
 UNITED KINGDOM            |   1998 | 272414677.412409
 UNITED KINGDOM            |   1997 | 466660260.783566
 UNITED KINGDOM            |   1996 |    465071418.672
 UNITED KINGDOM            |   1995 | 462711440.184802
 UNITED KINGDOM            |   1994 |  463943727.71429
 UNITED KINGDOM            |   1993 | 464295057.782674
 UNITED KINGDOM            |   1992 | 469175614.385197
 UNITED STATES             |   1998 | 272226946.235268
 UNITED STATES             |   1997 | 457283698.271839
 UNITED STATES             |   1996 |  463533135.55759
 UNITED STATES             |   1995 | 468079162.368796
 UNITED STATES             |   1994 | 471440510.690381
 UNITED STATES             |   1993 | 467430702.831615
 UNITED STATES             |   1992 | 464641532.579845
 VIETNAM                   |   1998 |  278465628.22682
 VIETNAM                   |   1997 | 464714424.404916
 VIETNAM                   |   1996 | 466088700.379263
 VIETNAM                   |   1995 | 468432062.280886
 VIETNAM                   |   1994 | 464517984.446688
 VIETNAM                   |   1993 | 471763456.536088
 VIETNAM                   |   1992 | 461194011.068461
(175 rows)

COMMIT;
COMMIT
