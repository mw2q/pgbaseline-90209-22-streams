BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%drab%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 264027055.018077
 ALGERIA                   |   1997 | 455874200.601123
 ALGERIA                   |   1996 | 449088997.092718
 ALGERIA                   |   1995 | 456098271.962293
 ALGERIA                   |   1994 | 460535643.903091
 ALGERIA                   |   1993 | 460935077.507044
 ALGERIA                   |   1992 | 458528295.027503
 ARGENTINA                 |   1998 |   277484917.7921
 ARGENTINA                 |   1997 | 464598216.914823
 ARGENTINA                 |   1996 | 477363789.913032
 ARGENTINA                 |   1995 | 465023113.263651
 ARGENTINA                 |   1994 | 469279405.400772
 ARGENTINA                 |   1993 | 481818014.813864
 ARGENTINA                 |   1992 | 471036930.640074
 BRAZIL                    |   1998 | 274013491.832725
 BRAZIL                    |   1997 | 465209188.636189
 BRAZIL                    |   1996 | 472535832.943453
 BRAZIL                    |   1995 | 464563004.200637
 BRAZIL                    |   1994 | 467556420.678819
 BRAZIL                    |   1993 | 467768378.771359
 BRAZIL                    |   1992 | 469882740.037026
 CANADA                    |   1998 | 280988767.183347
 CANADA                    |   1997 | 479199753.513185
 CANADA                    |   1996 |   487435266.3267
 CANADA                    |   1995 | 485111604.260104
 CANADA                    |   1994 | 488464996.805865
 CANADA                    |   1993 |  478454648.05013
 CANADA                    |   1992 |  479097037.54957
 CHINA                     |   1998 | 278312649.425373
 CHINA                     |   1997 |  475745180.49294
 CHINA                     |   1996 |  476486544.50122
 CHINA                     |   1995 | 476494439.739914
 CHINA                     |   1994 | 463254733.371702
 CHINA                     |   1993 | 472218233.351752
 CHINA                     |   1992 | 474008554.388642
 EGYPT                     |   1998 |   278559017.6193
 EGYPT                     |   1997 | 469958782.922016
 EGYPT                     |   1996 | 472282785.057078
 EGYPT                     |   1995 | 476911720.007029
 EGYPT                     |   1994 | 472516555.347564
 EGYPT                     |   1993 | 473415862.020582
 EGYPT                     |   1992 | 471760682.803336
 ETHIOPIA                  |   1998 | 280653254.893335
 ETHIOPIA                  |   1997 | 470866695.764788
 ETHIOPIA                  |   1996 | 466430376.969616
 ETHIOPIA                  |   1995 | 475705473.469689
 ETHIOPIA                  |   1994 | 474092167.827014
 ETHIOPIA                  |   1993 | 474898932.922304
 ETHIOPIA                  |   1992 | 478607192.407079
 FRANCE                    |   1998 | 272596792.217844
 FRANCE                    |   1997 | 465824849.378963
 FRANCE                    |   1996 | 466873557.136998
 FRANCE                    |   1995 | 468909383.170835
 FRANCE                    |   1994 | 467326702.321435
 FRANCE                    |   1993 | 465050332.573754
 FRANCE                    |   1992 | 464895894.298099
 GERMANY                   |   1998 | 280939510.522213
 GERMANY                   |   1997 |  470047451.70432
 GERMANY                   |   1996 | 473050320.743208
 GERMANY                   |   1995 | 471688025.742072
 GERMANY                   |   1994 | 485280960.020089
 GERMANY                   |   1993 | 475988896.277179
 GERMANY                   |   1992 | 477769471.830152
 INDIA                     |   1998 | 280090496.282647
 INDIA                     |   1997 | 473341522.841303
 INDIA                     |   1996 | 479590916.794795
 INDIA                     |   1995 | 473809668.827292
 INDIA                     |   1994 |  477012483.08817
 INDIA                     |   1993 | 473507358.889442
 INDIA                     |   1992 | 480526212.874402
 INDONESIA                 |   1998 | 275970023.772898
 INDONESIA                 |   1997 | 463496936.214829
 INDONESIA                 |   1996 | 478506120.153865
 INDONESIA                 |   1995 | 475367961.964939
 INDONESIA                 |   1994 | 463265299.075097
 INDONESIA                 |   1993 | 468413966.755029
 INDONESIA                 |   1992 | 466302213.515374
 IRAN                      |   1998 | 274621205.084969
 IRAN                      |   1997 | 468851387.172692
 IRAN                      |   1996 | 471465906.445922
 IRAN                      |   1995 |  475654698.31215
 IRAN                      |   1994 | 470674045.335003
 IRAN                      |   1993 | 479145993.190215
 IRAN                      |   1992 | 478036377.745501
 IRAQ                      |   1998 | 279946556.663535
 IRAQ                      |   1997 | 469219557.611231
 IRAQ                      |   1996 | 476423582.445641
 IRAQ                      |   1995 | 478117783.951455
 IRAQ                      |   1994 |  479664235.11079
 IRAQ                      |   1993 | 479388855.575138
 IRAQ                      |   1992 | 487000402.890112
 JAPAN                     |   1998 | 271345016.677939
 JAPAN                     |   1997 | 459951267.066072
 JAPAN                     |   1996 | 468286011.058628
 JAPAN                     |   1995 | 463938988.702731
 JAPAN                     |   1994 | 466998606.973366
 JAPAN                     |   1993 | 469566344.759969
 JAPAN                     |   1992 | 464065511.635948
 JORDAN                    |   1998 | 268817137.975498
 JORDAN                    |   1997 | 461391313.763425
 JORDAN                    |   1996 | 458773585.723032
 JORDAN                    |   1995 | 453833396.218723
 JORDAN                    |   1994 | 461947930.772515
 JORDAN                    |   1993 | 455933499.344997
 JORDAN                    |   1992 |  464962106.53571
 KENYA                     |   1998 | 270994107.185882
 KENYA                     |   1997 | 466515261.840461
 KENYA                     |   1996 | 474264348.313459
 KENYA                     |   1995 | 468133079.126287
 KENYA                     |   1994 | 471654657.345146
 KENYA                     |   1993 | 461767889.560307
 KENYA                     |   1992 | 472691356.958361
 MOROCCO                   |   1998 | 276965363.387905
 MOROCCO                   |   1997 | 480229360.374388
 MOROCCO                   |   1996 | 472042345.698074
 MOROCCO                   |   1995 | 477751228.270499
 MOROCCO                   |   1994 | 468105055.398415
 MOROCCO                   |   1993 | 469590643.445698
 MOROCCO                   |   1992 | 480240093.476037
 MOZAMBIQUE                |   1998 | 270891229.295816
 MOZAMBIQUE                |   1997 | 461471207.968911
 MOZAMBIQUE                |   1996 | 462934553.725579
 MOZAMBIQUE                |   1995 | 463672164.604834
 MOZAMBIQUE                |   1994 | 478813815.213087
 MOZAMBIQUE                |   1993 | 466514174.851226
 MOZAMBIQUE                |   1992 | 462338934.607776
 PERU                      |   1998 | 275578521.323566
 PERU                      |   1997 | 472557599.799942
 PERU                      |   1996 | 465244813.499106
 PERU                      |   1995 | 472217822.266742
 PERU                      |   1994 | 471560525.102673
 PERU                      |   1993 | 467561934.229379
 PERU                      |   1992 |  470083958.66826
 ROMANIA                   |   1998 | 269920114.665709
 ROMANIA                   |   1997 | 463214653.285908
 ROMANIA                   |   1996 | 469320748.322863
 ROMANIA                   |   1995 | 462958333.041644
 ROMANIA                   |   1994 | 467988925.032644
 ROMANIA                   |   1993 | 458914732.324443
 ROMANIA                   |   1992 | 467489646.349103
 RUSSIA                    |   1998 | 280691221.936659
 RUSSIA                    |   1997 | 475822746.171456
 RUSSIA                    |   1996 | 474250756.620448
 RUSSIA                    |   1995 | 468742204.884773
 RUSSIA                    |   1994 | 468809993.751693
 RUSSIA                    |   1993 | 463227412.295944
 RUSSIA                    |   1992 | 466937935.026103
 SAUDI ARABIA              |   1998 | 281356696.154088
 SAUDI ARABIA              |   1997 | 470611543.872381
 SAUDI ARABIA              |   1996 | 468810773.272564
 SAUDI ARABIA              |   1995 | 472226539.426412
 SAUDI ARABIA              |   1994 | 465123184.557835
 SAUDI ARABIA              |   1993 | 469628547.270139
 SAUDI ARABIA              |   1992 | 470340763.634544
 UNITED KINGDOM            |   1998 | 275979070.813725
 UNITED KINGDOM            |   1997 | 462282086.057611
 UNITED KINGDOM            |   1996 | 464485552.605279
 UNITED KINGDOM            |   1995 | 463952955.900361
 UNITED KINGDOM            |   1994 | 469521926.426362
 UNITED KINGDOM            |   1993 |  465736121.70057
 UNITED KINGDOM            |   1992 | 467137371.030138
 UNITED STATES             |   1998 | 277627670.602123
 UNITED STATES             |   1997 | 470898892.232892
 UNITED STATES             |   1996 | 473686813.358548
 UNITED STATES             |   1995 |  465991542.31484
 UNITED STATES             |   1994 | 465487602.440167
 UNITED STATES             |   1993 | 470208045.773651
 UNITED STATES             |   1992 | 477125194.247339
 VIETNAM                   |   1998 | 275016632.852346
 VIETNAM                   |   1997 | 464080983.955876
 VIETNAM                   |   1996 | 464918194.056451
 VIETNAM                   |   1995 | 463604242.387637
 VIETNAM                   |   1994 | 464126545.894589
 VIETNAM                   |   1993 | 456821807.464401
 VIETNAM                   |   1992 |  463277999.18634
(175 rows)

COMMIT;
COMMIT
